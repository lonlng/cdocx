---
---
# CDocx - C++ DOCX Library

## Project Overview

CDocx is a C++17 library for creating, reading, and writing Microsoft Office Word (.docx) files. The library provides a simple, iterator-based API for document manipulation with support for text formatting, paragraphs, tables, and template-based document generation.

**Key Facts:**
- Language: C++17
- License: MIT
- Build System: CMake (minimum version 3.0)
- Namespace: `cdocx`
- Version: 0.2
- External Dependencies: pugixml, zip (both bundled in thirdparty/)

## Architecture

### Core Components

1. **Document Class** (`cdocx::Document`)
   - Entry point for all DOCX operations
   - Handles file I/O and ZIP archive management using zip library
   - Provides access to paragraphs and tables
   - Manages XML document structure using pugixml

2. **Paragraph Class** (`cdocx::Paragraph`)
   - Represents document paragraphs
   - Contains runs (text segments with formatting)
   - Supports insertion and text manipulation
   - Iterator-based traversal with `has_next()` and `next()` methods

3. **Run Class** (`cdocx::Run`)
   - Represents formatted text segments
   - Supports various formatting flags (bold, italic, underline, etc.)
   - Iterator-based traversal
   - Text manipulation with `get_text()` and `set_text()` methods

4. **Table Classes** (`cdocx::Table`, `cdocx::TableRow`, `cdocx::TableCell`)
   - Full table manipulation support
   - Row and cell iteration
   - Hierarchical structure: Table → Row → Cell → Paragraph

5. **Template Class** (`cdocx::Template`)
   - Template-based document generation
   - Placeholder replacement with custom patterns (default: `{{` and `}}`)
   - Supports replacement in paragraphs and tables

6. **Iterator System** (`cdocxIterator.h`)
   - Modern C++11 iterator support using `begin()` and `end()`
   - Template-based iterator implementation
   - Compatible with range-based for loops

### File Organization

```
include/
├── cdocx.h          # Main library header with all class declarations
├── constants.h      # Formatting flags and constants
└── cdocxIterator.h  # Iterator helper classes and templates

src/
└── cdocx.cpp        # Main implementation

thirdparty/
├── pugixml/         # XML parsing library (Git submodule)
└── zip/             # ZIP archive handling library

test/
├── basic_tests.cpp           # Core functionality tests
├── iterator_tests.cpp        # Iterator pattern tests
├── template_tests.cpp        # Template functionality tests
├── generate_test_data.py     # Python script to generate test DOCX files
├── doctest.h                 # Header-only test framework
└── TESTING.md               # Comprehensive testing guide

samples/
├── sample1.cpp              # Basic document reading example
├── sample2.cpp              # Document creation example
├── sample_template.cpp      # Template usage example
├── advanced_template.cpp    # Advanced template features
└── *.docx                   # Sample document files
```

## Technology Stack

### Core Dependencies
- **pugixml**: XML parsing and manipulation
- **zip**: ZIP archive handling for DOCX format
- **C++17**: Modern C++ features (structured bindings, if-initializers, etc.)

### Build System
- **CMake**: Cross-platform build configuration
- **CTest**: Testing framework integration
- **Git Submodules**: Dependency management for pugixml

### Testing Framework
- **doctest**: Header-only C++ testing framework
- **Python**: Test data generation scripts

## Build Instructions

### Basic Build
```bash
mkdir build
cd build
cmake ..
cmake --build .
```

### Build Options
- `BUILD_SHARED_LIBS=ON/OFF` - Build shared library (default: OFF)
- `BUILD_SAMPLES=ON/OFF` - Build sample programs (default: OFF)
- `BUILD_TESTING=ON/OFF` - Enable tests (default: ON when main project)

### Installation
```bash
cmake --install . --prefix /usr/local
```

### Manual Compilation
```bash
g++ your_file.cpp -I/path/to/cdocx/include -L/path/to/cdocx/lib -lcdocx
```

## Testing

### Run All Tests
```bash
cd build
ctest
# or
cmake --build . --target check
```

### Test Suites
- **unit_tests**: Basic document operations
- **iterator_tests**: Iterator functionality
- **template_tests**: Template replacement features

### Run Specific Tests
```bash
ctest -R template_tests  # Run only template tests
ctest -V                 # Verbose output
```

### Test Data Generation
Test DOCX files are automatically generated by `generate_test_data.py` during CMake configuration.

## Code Style Guidelines

### Formatting
- Based on LLVM style (`.clang-format`)
- Indentation: 4 spaces
- Use provided `.clang-format` configuration

### Naming Conventions
- Classes: PascalCase (`Document`, `Paragraph`)
- Methods: snake_case (`get_text()`, `set_text()`)
- Constants: snake_case (`bold`, `italic`)
- Namespace: lowercase (`cdocx`)
- Files: snake_case with `.h` and `.cpp` extensions

### Design Patterns
- Iterator pattern for document traversal
- Fluent interface for method chaining
- RAII for resource management
- Template-based generic programming

## Usage Examples

### Reading a Document (Traditional Iterator)
```cpp
#include <cdocx.h>

cdocx::Document doc("file.docx");
doc.open();

for (auto p = doc.paragraphs(); p.has_next(); p.next()) {
    for (auto r = p.runs(); r.has_next(); r.next()) {
        std::cout << r.get_text() << std::endl;
    }
}
```

### Reading a Document (Modern Iterator)
```cpp
#include <cdocx.h>

cdocx::Document doc("file.docx");
doc.open();

for (auto p : doc.paragraphs()) {
    for (auto r : p.runs()) {
        std::cout << r.get_text() << std::endl;
    }
}
```

### Writing a Document
```cpp
cdocx::Document doc("output.docx");
doc.open();

cdocx::Paragraph p = doc.paragraphs().insert_paragraph_after("Hello ");
p.add_run("World", cdocx::bold);
p.add_run("!", cdocx::italic);

doc.save();
```

### Template Usage
```cpp
cdocx::Document doc("template.docx");
doc.open();

cdocx::Template tmpl(&doc);
tmpl.set("name", "John Doe");
tmpl.set("date", "2023-12-18");
tmpl.replace_all();

doc.save("output.docx");
```

## Security Considerations

### File Handling
- DOCX files are ZIP archives - validate file format before processing
- XML parsing should handle malformed documents gracefully
- Avoid path traversal when extracting ZIP contents
- Validate string lengths to prevent buffer overflows

### Memory Management
- Use RAII principles for automatic resource management
- Check for null pointers from external libraries
- Handle memory allocation failures appropriately
- Be cautious with large document processing

### Input Validation
- Validate all file paths and names
- Sanitize text content to prevent XML injection
- Handle Unicode/encoding issues properly
- Set appropriate limits on document size and complexity

## Development Workflow

### Adding New Features
1. Add class declarations to `include/cdocx.h`
2. Implement in `src/cdocx.cpp`
3. Add tests to appropriate test file
4. Update documentation in `docs/`
5. Add sample code if applicable
6. Update test data generation if needed

### Code Review Checklist
- Follow existing naming conventions
- Use iterator pattern for collections
- Handle XML parsing errors gracefully
- Update tests for new functionality
- Document public APIs
- Ensure memory safety

## Common Pitfalls

1. **Iterator Usage**: Always check `has_next()` before calling `next()` with traditional iterators
2. **File Paths**: Use absolute paths or ensure relative paths are correct
3. **Formatting Flags**: Combine flags using bitwise OR (`cdocx::bold | cdocx::italic`)
4. **Document State**: Call `save()` after modifications to persist changes
5. **Memory Management**: Be aware of object lifetimes when using iterators
6. **Error Handling**: Check `is_open()` before document operations

## Performance Notes

- DOCX files are processed as ZIP archives in memory
- XML parsing uses pugixml for efficiency
- Iterator pattern minimizes memory allocation
- Consider batch operations for large documents
- Template replacement processes entire document

## Integration

### CMake Integration
```cmake
find_package(cdocx REQUIRED)
target_link_libraries(your_target cdocx::cdocx)
```

### Git Submodule Integration
```bash
git submodule update --init --recursive
```

## Troubleshooting

### Build Issues
- Ensure CMake version 3.0+ is installed
- Check that Git submodules are initialized
- Verify C++17 compiler support
- Check for missing dependencies

### Runtime Issues
- Validate DOCX file format
- Check file permissions
- Ensure proper document lifecycle management
- Verify XML namespace handling

### Testing Issues
- Regenerate test data if files are missing
- Check Python version for test data generation (3.6+)
- Verify test file locations in build directory

## Continuous Integration

The project uses Travis CI with the following matrix:
- Ubuntu Bionic with GCC
- CMake build system
- Automated testing with CTest

---